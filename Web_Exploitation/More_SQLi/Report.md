# More SQLi
## Description
>Can you find the flag on this website. Try to find the flag [here](http://saturn.picoctf.net:53241/)

---
Thanks to [sergyperov](https://ctftime.org/writeup/21125) for the helpful writeup!

---
Entering the site we see a login page. Based on the name of the challenge, we will start with a simple SQL injection payload: `'or 1=1-- `
On the first attempt with a random input, we get an error. This is more useful than usual, however, as it tells us the SQL query happening in the background:
```
username: 'or 1=1-- 
password: 345534
SQL query: SELECT id FROM users WHERE password = '345534' AND username = ''or 1=1-- '
```
Since password is being called first, we can insert our injection into this field and it should work.
After bypassing login, we see a table of information:

![image](https://github.com/spencerja/picoCTF_2023_Writeup/blob/main/Web_Exploitation/More_SQLi/screencaps/Pasted%20image%2020230328074137.png)

There's no flag here, but one of the addresses seems to be a little interesting: "Maybe all the tables". Doing our regular SQL injection `'or 1=1-- ` in the search bar results in the same information. It appears that although we are dumping all information from the current table, the flag is actually in a different table? In order to dump all tables we will look into UNION injections.

First to explore union injections, we need to know the number of columns in this table. With this challenge, we can clearly see three tables, but just to be sure, we will check a UNION injection including 3 columns. If the column number doesn't match the SQL query, the search will fail.
```
Kampala' UNION SELECT NULL,NULL,NULL-- 
```
![image](https://github.com/spencerja/picoCTF_2023_Writeup/blob/main/Web_Exploitation/More_SQLi/screencaps/Pasted%20image%2020230328074947.png)

Note that choosing Kampala to search isn't required, but it can make it easier to see our row of NULLs between it and the City/Address/Phone header.

From here, we need to know which columns might be text injectable. Since city and address contain strings, these two are likely, however phone consists of numbers so possibly not the third column. Testing all 3 at once:
```
Kampala' UNION SELECT "abc","abc","abc"--
```

![image](https://github.com/spencerja/picoCTF_2023_Writeup/blob/main/Web_Exploitation/More_SQLi/screencaps/Pasted%20image%2020230328075303.png)

All three columns return our injected string, meaning we can dump information out of any of these three columns. Note you only need one column working to proceed with union injection, and also if you try injecting your string into a column that cannot take string values then the entire SQL query fails.

Probing the SQL tables:
```
Kampala' UNION SELECT sql,NULL,NULL from sqlite_master LIMIT 1,5; -- 
```
![image](https://github.com/spencerja/picoCTF_2023_Writeup/blob/main/Web_Exploitation/More_SQLi/screencaps/Pasted%20image%2020230328080123.png)

by pulling sql from sqlite_master, we can see 4 more tables:
- hints
- more_table
- offices
- users

Normally users would be the most interesting for us, but our hint about "Maybe all the tables" is hinting towards the more_tables table first. We can check each table by using the same type of UNION injection. Note that this table list output also gives us the column names: `id` and `flag`. Another reason to try this table first:
```
Kampala' UNION SELECT id,flag,NULL from more_table where 1=1-- 
```

![image](https://github.com/spencerja/picoCTF_2023_Writeup/blob/main/Web_Exploitation/More_SQLi/screencaps/Pasted%20image%2020230328080756.png)

And with that, we have our flag. 
picoCTF{G3tting_5QL_1nJ3c7I0N_l1k3_y0u_sh0ulD_62aa7500}
